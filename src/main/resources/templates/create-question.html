<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Create Question</title>
</head>

<body>
    <div th:if="${message}" id="messageDiv" class="alert alert-success">
        <p th:text="${message}"></p>
    </div>

    <form th:action="@{/user/dashboard}" method="get">
        <input type="submit" value="Back to main page"
            style="background-color: black; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer;" />
    </form>

    <h1>Create Question</h1>

    <form th:action="@{/create-question}" method="post">
        <label for="text">Question Text:</label>
        <input type="text" id="text" name="text" required /><br /><br />

        <div>
            <label>Question Type:</label>
            <input type="radio" id="questionType" name="questionType" value="multiple-choice" checked /> Multiple-Choice
            <input type="radio" id="questionType" name="questionType" value="type-in" /> Type-In
        </div><br>

        <button type="button" id="add-choice">Add more choice</button>

        <div id="choices-container" style="display: none">
            <br>Choices:
            <input type="text" id="choices" name="choices" style="display: none" />
        </div>

        <div id="answer-container" style="display: none">
            <label for="answer">Answer:</label>
            <input type="text" id="answer" name="answer" required />
        </div><br>

        <label for="subject">Subject:</label>
        <input type="text" id="subject" name="subject" required /><br /><br />

        <label for="chapter">Chapter:</label>
        <input type="text" id="chapter" name="chapter" required /><br /><br />

        <label for="difficulty">Difficulty:</label>
        <input type="text" id="difficulty" name="difficulty" required /><br /><br />

        <input type="submit" value="Create Question" />
    </form>

    <script th:inline="javascript">
        // JavaScript to add/remove choice input fields
        const questionTypeRadios = document.querySelectorAll('input[name="questionType"]');
        const choicesContainer = document.getElementById('choices-container');
        const answerContainer = document.getElementById('answer-container');
        const addChoiceButton = document.getElementById('add-choice');
        const choiceRadio = document.getElementsByName('correctChoice');
        const choicesInput = document.getElementsByName('choices');

        // Function to handle radio button change
        function handleQuestionTypeChange() {
            if (questionTypeRadios[0].checked) {
                choicesContainer.style.display = 'block';
                addChoiceButton.style.display = 'block';
                answerContainer.style.display = 'none';
                choiceRadio.required = true;
                choicesInput.required = true;
            } else {
                choicesContainer.style.display = 'none';
                addChoiceButton.style.display = 'none';
                answerContainer.style.display = 'block';
                choiceRadio.required = true;
                choicesInput.required = true;
            }
        }

        // Add event listener to radio buttons
        questionTypeRadios.forEach(function (radio) {
            radio.addEventListener('change', handleQuestionTypeChange);
        });

        // Initial state based on the default selected question type
        handleQuestionTypeChange();

        addChoiceButton.addEventListener('click', () => {
            const newChoiceDiv = document.createElement('div');
            const newChoiceInput = document.createElement('input');
            newChoiceInput.type = 'text';
            newChoiceInput.name = 'choices';
            newChoiceInput.required = true;

            const newRadio = document.createElement('input');
            newRadio.type = 'radio';
            newRadio.name = 'correctChoice';
            newRadio.value = choicesContainer.children.length; // Assign a unique value
            newRadio.required = true; // Make it required
            newRadio.addEventListener('change', function () {
                if (newRadio.checked) {
                    document.getElementById('answer').value = newChoiceInput.value;
                }
            });

            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'remove-choice';
            removeButton.textContent = 'Remove';
            removeButton.addEventListener('click', function () {
                newChoiceDiv.remove();
            });

            newChoiceDiv.appendChild(newRadio);
            newChoiceDiv.appendChild(newChoiceInput);
            newChoiceDiv.appendChild(removeButton);

            choicesContainer.appendChild(newChoiceDiv);
        });

        setTimeout(function () {
            var messageDiv = document.getElementById("messageDiv");
            if (messageDiv) {
                messageDiv.style.display = "none";
                messageDiv.parentElement.removeChild(messageDiv);
            }
        }, 2000); // message disappears after 2s
    </script>

    <style>
        .choices-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .redirect-button {
            display: inline-block;
            padding: 5px 10px;
            font-size: 14px;
            background-color: #000000;
            color: #fff;
            text-decoration: none;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</body>

</html>